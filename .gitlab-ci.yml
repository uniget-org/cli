include:
- component: $CI_SERVER_FQDN/uniget-org/components/renovate@renovate/1.0.5
  inputs:
    rules:
    - if: $CI_PIPELINE_SOURCE == "schedule" && $SCHEDULED_JOB == "renovate"
    - if: $CI_PIPELINE_SOURCE == "web" && $SCHEDULED_JOB == "renovate"
    token_variable_name: RENOVATE_TOKEN
    github_token_variable_name: RENOVATE_GITHUB_TOKEN

test:
  rules:
  - if: $CI_PIPELINE_SOURCE == "push" && $CI_COMMIT_REF == $CI_DEFAULT_BRANCH
  - if: $CI_COMMIT_TAG =~ /^v/
  trigger:
    include: pipeline/test.yaml

release:
  rules:
  - if: $CI_COMMIT_TAG =~ /^v/
    needs:
    - test
  trigger:
    include: pipeline/release.yaml

images:
  rules:
  - if: $CI_COMMIT_TAG =~ /^v/
    needs:
    - release
    variables:
      PUSH: "true"
  - if: $CI_PIPELINE_SOURCE == "merge_request_event"
    changes:
    - Dockerfile
    variables:
      PUSH: "false"
  - if: $CI_PIPELINE_SOURCE == "web"
    variables:
      PUSH: "true"
  - if: $CI_PIPELINE_SOURCE == "schedule" && $SCHEDULED_JOB == "daily_rebuild"
    variables:
      PUSH: "true"
  trigger:
    include: pipeline/image.yaml

scorecard:
  rules:
  - if: $CI_COMMIT_TAG =~ /^v/
    needs:
    - release
  trigger:
    include: pipeline/scorecard.yaml
